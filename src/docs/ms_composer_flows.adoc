= Build and Test a Composer Flow

After you have collected the information as described in xref:ms_composer_checklist.adoc[the preparation checklist], build and test your flow:

. Create and name a flow.
. In the flow, create a trigger or flow control, and test.
. In the flow, create each action in order. Test each action before adding the next.

After these steps are complete, you're ready to activate the flow, and then monitor it.

== Create a New Flow

You can create a new flow or clone an existing flow.

=== Create a New Flow

To create a new flow:

. From the Composer Home page, click *Create New Flow*.

. Click the pencil next to *Untitled Flow* and give your flow a name.
. Click *Save*.

Now you are ready to create a trigger or set a timed interval that controls when the flow runs.

=== Clone an Existing Flow

To clone an existing flow:

. From the *Composer Flows* tab, click the name of the flow you want to clone. Composer displays the Flow Details page.
. Click *Clone*.
. Composer copies the existing flow and opens the copy in the Flow Details page. Notice the flow is named *Copy of _original flow name_*.

== Create a Flow Trigger

After you have created or cloned a flow, define the trigger: the event or time interval that starts the flow.

To define a trigger based on an event:

. Open a flow if it is not already open. The *What Should Start This Flow?* dialog is displayed.
+
image:images/connection-example.png[What Should Start This Flow dialog, 500]
. Select the system where the triggering event occurs. Your existing connections are displayed.
+
image:images/list-of-connections.png[List of connections, 500]
+
You can choose an existing connection or create a new one:

* Click an existing connection to select it.
* Click *Add new Salesforce Connection* to create a new connection and select it.
+
You can rename or delete connections from this dialog by clicking the gear icon.

. After you choose a connection, the trigger step displays:
+
image:images/trigger-definition.png[Trigger step, 600]
+
* Optionally, replace *Untitled Step* with a trigger name of your choice.
* Choose an event that starts the flow. Supply additional information as requested.

You can save and test your trigger, or delete and replace it.
A trigger step is required to test or activate your flow.

== Change a Connection

You can change connections in a trigger or action. For example, you can create a flow using connections to a Salesforce sandbox org, and then after your flow testing is complete, you can change the connection in your trigger and actions to use a production org.

You can only change to a connection accessing the same system type. You can't change a Workday connection to a Google Sheets connection, for example.

To change a connection:

. Open the flow.
. Click the change icon in the trigger or action that connects to a sandbox:
+
image::images/change-connection.png[Change the connection control, 400]

. Choose a new connection and save your changes.

After creating or changing a connection, click *Test* in the Flow Details menu bar to test that your connection works.

== Schedule a Flow

If you don't choose a connection, you can schedule a flow to start at regular intervals.

To create a flow control:

. In a new flow, from the *What Should Start This Flow?* dialog, look in the Flow Control section and click *Scheduler*.
+
image:images/connection-example.png[What Should Start This Flow dialog, 500]
. Choose one of the time intervals, from 15 minutes to 30 days.
+
image::images/connection-scheduler.png[New trigger with time interval, 500]
. Click *Save*.

After you have chosen the trigger or flow control, your next step is to add one or more actions to the flow. You can also add an If/Else block or For Each loop before an action if you need to apply logic to the action.

== Create and Test an Action

To create and test an action:

. After the trigger or flow control in your flow, click the large plus sign to open the *Add Action* dialog.
. Click or create a connection for the action.
+
For example, if your trigger is "new records created in Salesforce," and you want your action to be "copy new record to a Google Sheet," then you would choose or create a Google Sheet connection.
. Select an action, and any other values displayed. What you have to specify for an action depends on system type you are connected to for the action.
. Click *Save* from the Flow Details menu bar.
. Click *Test* to test your action. Composer gives you five minutes to test. For example, if you were testing an action to copy every new contact in a Salesforce org, you'd click *Test*, then log into the Salesforce org and create a new contact.
. Composer notifies you when the test is complete.

Test after every trigger, flow control, and action you add to your flow. Testing often makes diagnosing problems easier.

After you've tested the complete flow, you're ready to activate.

== Create and Test a Flow Control

If you need to perform some logic before an action, select a flow control first:

. After the trigger or flow control in your flow, click the large plus sign to open the *Add Action* dialog.
. Click either *If/Else Block* or *For Each*. An If/Else block is good when you need to do different actions depending on one or more conditions. A For Each loop is good for processing a set of records.
. Complete the flow control, which usually includes adding an action.
. Save and test.

=== Create and Test an If/Else Block

To create and test an If/Else block:

. Click the plus sign after the trigger or the last action in your flow.
. Click *Add Action*.
. Click *If/Else Block* to define the first branch.
. Enter the requested criteria.
. Click the plus sign to add an action. Every condition must have an action, also called a step.
. Click *Add If* and repeat the previous steps for every If/Else branch you create.
. Click *Add Else* and repeat the previous steps for the final branch--the action to take if all other branches fail.
. After you add all the branches, click *Save*.

=== Create and Test a For Each Loop

To create and test a For Each Loop:

. Click the plus sign after the trigger or the last action in your flow.
. Click *Add Action*.
. Click *For Each*.
. Choose a data pill from the *Input list*. You must have a trigger or action that returns a set of records or there won't be anything to choose here.
. Click the plus sign to add an action.
. After you complete the action, click *Save* and then test.

You can add logic and actions in different patterns, depending on what your flow needs to do.

== Preparing for Activation

After you test your completed flow, you are ready to activate it.

If you used connections to a sandbox org while creating and testing the flow, don't forget to change the connections to production orgs and retest before activating.

== Monitor and Troubleshoot the Flow

Once your flow is active, it runs in the background. If there is an issue with your flow, you will be alerted via email. An alert email describes what flow has an issue and the resulting error that occurred.

To troubleshoot the flow:

. From the *Composer Flows* tab, click the name of the flow you want to troubleshoot. Composer displays the Flow Details page.
. On the Flow Details page, review the table displaying past jobs and errors.
. Locate the error description to troubleshoot your flow.
